{% extends 'main.html' %}
{% load django_bootstrap5 django_bootstrap_input_group static %}
{% block content %}

<div class="container mt-4">
    <!-- Document Details -->
    <div class="card mb-4">
        <div class="card-body">
            <h1 class="card-title">Detalle del Documento</h1>
            <p><strong>Id:</strong> {{ documento.documento_idno }}</p>
            <p><i class="fas fa-university"></i> {{ documento.archivo }}</p>
            <p><i class="far fa-folder-open"></i> {{ documento.fondo }}, {{ documento.subfondo }},
            {% if documento.sigla_documento %} {{ documento.sigla_documento }}, {% endif %} {{ documento.get_tipo_udc_display }} {{ documento.unidad_documental_compuesta }}, f. {{ documento.folio_inicial }}</p>
        </div>
        <!-- Action Buttons -->
        <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
                {% if perms.esclavizados.add_documento %}
                    <a href="{% url 'documento-update' documento.pk %}" class="btn btn-outline-primary">Editar</a>
                {% endif %}
                {% if perms.dbgraphic.delete_documento %}
                    <a href="{% url 'documento-delete' documento.pk %}" class="btn btn-outline-danger">Borrar</a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Main Document Card -->
    <div class="card mb-3">
        <div class="card-body">
            <h2 class="card-title">{{ documento.titulo }}</h2>
            <p class="card-text">{{ documento.get_tipo_documento_display }}</p>
            <p class="card-text"><i class="far fa-calendar-alt"></i> {{ documento.fecha_inicial }}</p>
            <p class="card-text">Valor del evento en pesos: {{ documento.evento_valor_sp }} {{ documento.evento_forma_de_pago }}

                <h3>Personas esclavizadas asociadas al documento</h3>
                <!-- ForeignKey Links -->
                {% if perms.esclavizados.add_personaesclavizada %}
                    <a href="{% url 'personaesclavizada-new' %}?documento_initial={{ documento.pk }}" class="btn btn-info mt-3"><i class="fas fa-user-alt"></i> Añadir persona esclavizada al documento</a>
                {% endif %}
                <div class="row" style="padding:15px;">
                    {% for peresclavizada in peresclavizadas %}
                        <div class="col-md-6 col-lg-4 mb-4">
                            <div class="card">
                                <div class="card-header">
                                    {{ peresclavizada.nombre_normalizado }} (ID: {{ peresclavizada.persona_idno }}) 
                                    {% if perms.esclavizados.add_personaesclavizada %} <a href='{% url 'personaesclavizada-detail' peresclavizada.pk %}' class="btn btn-outline-dark me-2"><i class="far fa-eye"></i></a>{% endif %}
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">Lugares Asociados</h5>
                                    <p class="card-text">
                                        <strong>Lugares anteriores al evento:</strong>
                                        <br>
                                        {% for perexlug in personaesclavizadalugarrel %}
                                            {% if perexlug.anterior_posterior == '1' and perexlug.documento == documento and perexlug.persona == peresclavizada %}
                                                - {{ perexlug.lugar }}<br>
                                            {% endif %}
                                        {% endfor %}
                                    </p>
                                    <p class="card-text">
                                        <strong>Lugares posteriores al evento:</strong>
                                        <br>
                                        {% for perexlug in personaesclavizadalugarrel %}
                                            {% if perexlug.anterior_posterior == '2' and perexlug.documento == documento and perexlug.persona == peresclavizada %}
                                                - {{ perexlug.lugar }}<br>
                                            {% endif %}
                                        {% endfor %}
                                    </p>
                                    {% if perms.esclavizados.add_personaesclavizadalugarrel %}
                                        <a href="{% url 'personaesclavizada_x_lugar-new' %}?documento_initial={{ documento.pk }}&personaesclavizada_initial={{ peresclavizada.pk }}" class="btn btn-success mt-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Añadir lugar previo o posterior al evento"><i class="fas fa-shoe-prints"></i> Añadir lugar</a>
                                    {% endif %}
                                    {% if perms.esclavizados.add_personaesclavizadalugarrel %}
                                        <a href="{% url 'persona_x_persona-new' %}?documento_initial={{ documento.pk }}&personaesclavizada_initial={{ peresclavizada.pk }}" class="btn btn-success mt-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Añadir relación entre dos personas"><i class="fas fa-people-arrows"></i> Añadir relación</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                
                
        </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <a href="{% url 'documento-browse' %}" class="btn btn-outline-secondary">Regresar</a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.forEach(function (tooltipTriggerEl) {
            new bootstrap.Tooltip(tooltipTriggerEl);
        });
    });
</script>

{% endblock content %}
